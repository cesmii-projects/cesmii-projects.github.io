<html>
  <body>
    <div id="chart_div" style="width: 100%; height: 500px;"></div>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
    <script>
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(() => {
        // Instead of hard-coding the initial table data,
        // you could fetch it from your server.
        const dataTable = google.visualization.arrayToDataTable([
          ['Time', 'Power (W)'],
          [Date(),0],
        ]);
        const chart = new google.visualization.AreaChart(
          document.getElementById('chart_div'));
        const options = {
          title: 'Live Power on CNC machine at ATAMI',
          hAxis: {title: 'Time' , titleTextStyle: {color: '#333'}},
          vAxis: {minValue: 0},
          animation:{ duration: 100, easing: 'out' }
        };
        chart.draw(dataTable, options);
        Pusher.logToConsole = true;
        const pusher = new Pusher('d1fdb3f9f438ffe7ba1a', { // Replace with 'key' from dashboard
          cluster: 'us3',              // Replace with 'cluster' from dashboard
          forceTLS: true
        });
        const channel = pusher.subscribe('live_power');
        channel.bind('current_power', data => {
          const row = [new Date(2021,3,6,17,33,data.se), data.power];
          dataTable.addRow(row);
          chart.draw(dataTable, options);
        });
      });
    </script>
    updated: 2021-04-06-17-35 -7:00
  </body>
</html>