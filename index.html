<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Live Power on CNC Machine at ATAMI (Oregon State University)</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css">
  <style>
      .chart {
          height: 800px;
      }
  </style>
</head>
<body>
  <section class="power">
    <div class="container">
      <h1 class="title"><strong>Live Data on CNC machine at ATAMI</strong></h1>
      <p class="subtitle">View live data of HAAS VF-2 machine.</p>
      <hr>
      <div class="columns">
        <div class="column">
          <h5 style="font-size:2em" class="title is-6">Power [W]</h5>
          <div id="Live_Power_Chart" class="chart" style="width: 100%; height: 300px;"></div>
        </div>
      </div>
    </div>
  </section>
  <section class="temp">
    <div class="container">
      <div class="columns">
        <div class="column">
          <h5 style="font-size:2em"  class="title is-6">Temperature [C]</h5>
          <div id="Live_temp_Chart" class="chart2" style="width: 100%; height: 300px;"></div>
        </div>
      </div>
    </div>
  </section>
  <section class="acoustic">
    <div class="container">
      <div class="columns">
        <div class="column">
          <h5 style="font-size:2em"  class="title is-6">Acoustic Pressure [Pa]</h5>
          <div id="Live_ae_Chart" class="chart3" style="width: 100%; height: 300px;"></div>
        </div>
      </div>
    </div>
  </section>
  <section class="Accelerometer">
    <div class="container">
      <div class="columns">
        <div class="column">
          <h5 style="font-size:2em"  class="title is-6">Dynamometer [kN]</h5>
            <h7 style="font-size:1em"  class="title is-6">Force (X-axis) [kN]</h7>
          <div id="Live_acc_Chart_x" class="chart4" style="width: 100%; height: 200px;"></div>
            <h7 style="font-size:1em"  class="title is-6">Force (Y-axis) [kN]</h7>
          <div id="Live_acc_Chart_y" class="chart5" style="width: 100%; height: 200px;"></div>
            <h7 style="font-size:1em"  class="title is-6">Force (Z-axis) [kN]</h7>
          <div id="Live_acc_Chart_z" class="chart6" style="width: 100%; height: 200px;"></div>
        </div>
      </div>
    </div>
  </section>

<!--   <section class="scan">
    <div class="container-fluid" style="margin-top:40px">
      <iframe src="test.html" height="500px"></iframe>
    </div>
  </section> -->
    
    
  <!-- <div id="chart_div" style="width: 100%; height: 200px;"></div> -->
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
  <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script type="text/javascript">
      
    $(document).ready( function() {
      refresh();
    });
      
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(() => {
      // Instead of hard-coding the initial table data,
      // you could fetch it from your server.
        
 // ................... POWER ............................ //     
      const dataTable = google.visualization.arrayToDataTable([
        ['Time', 'Power (W)'],
        [new Date('hh-mm-ss'),0],
      ]);
      const chart = new google.visualization.ScatterChart(
        document.getElementById('Live_Power_Chart'));

      const options = {
        hAxis: {title: 'Time' , titleTextStyle: {color: '#333', fontSize: 26, bold: true}},
        vAxis: {minValue: 0, textStyle: {color: '#333', fontSize: 26, bold: true}},
        animation:{duration: 100, easing: 'inAndout'},
        annotations:{ alwaysOutside: true, textStyle: {fontSize: 26}},
        legend: {position: 'Top', textStyle: {bold: true}}
      };

      Pusher.logToConsole = true;
      const pusher = new Pusher('d1fdb3f9f438ffe7ba1a', { // Replace with 'key' from dashboard
        cluster: 'us3',              // Replace with 'cluster' from dashboard
        forceTLS: true
      });
      
      const channel = pusher.subscribe('live_power');
      channel.bind('current_power', data1 => {
        const row = [new Date(data1.ye,data1.mo,data1.da,data1.ho,data1.mi,data1.se,data1.ms), data1.power];
        dataTable.addRow(row);
        chart.draw(dataTable, options);
      });
// ................... TEMP ............................ //
      const dataTable2 = google.visualization.arrayToDataTable([
        ['Time', 'Temp (C)'],
        [new Date('hh-mm-ss'),0],
      ]);
      const chart2 = new google.visualization.ScatterChart(
        document.getElementById('Live_temp_Chart'));

      const pusher2 = new Pusher('7ed63ca2bc241415db8f', { // Replace with 'key' from dashboard
        cluster: 'us3',              // Replace with 'cluster' from dashboard
        forceTLS: true
      });
      
      const channel2 = pusher2.subscribe('live_temp');
      channel2.bind('current_temp', data2 => {
        const row2 = [new Date(data2.ye,data2.mo,data2.da,data2.ho,data2.mi,data2.se,data2.ms), data2.temp];
        dataTable2.addRow(row2);
        chart2.draw(dataTable2, options);
      });
        
// ................... ACOUSTIC EMISSION ............................ //
      const dataTable3 = google.visualization.arrayToDataTable([
        ['Time', 'Pressure (Pa)'],
        [new Date('hh-mm-ss'),0],
      ]);
      const chart3 = new google.visualization.ScatterChart(
        document.getElementById('Live_ae_Chart'));
        
      const pusher3 = new Pusher('ae00cc78fac228b3fd0e', { // Replace with 'key' from dashboard
        cluster: 'us3',              // Replace with 'cluster' from dashboard
        forceTLS: true
      });
      
      const channel3 = pusher3.subscribe('live_ae');
      channel3.bind('current_ae', data3 => {
        const row3 = [new Date(data3.ye,data3.mo,data3.da,data3.ho,data3.mi,data3.se,data3.ms), data3.acoustic];
        dataTable3.addRow(row3);
        chart3.draw(dataTable3, options);
      });
// ................... ACCELERATION ............................ //
      const dataTable4 = google.visualization.arrayToDataTable([
        ['Time', ' X-Force (kN)'],
        [new Date('hh-mm-ss'),0],
      ]);
        
      const chart4 = new google.visualization.ScatterChart(
        document.getElementById('Live_acc_Chart_x'));

      const pusher4 = new Pusher('054ba50a2a1662cd7953', { // Replace with 'key' from dashboard
        cluster: 'us3',              // Replace with 'cluster' from dashboard
        forceTLS: true
      });
      
      const channel4 = pusher4.subscribe('live_acc');
      channel4.bind('current_acc', data4 => {
        const row4 = [new Date(data4.ye,data4.mo,data4.da,data4.ho,data4.mi,data4.se,data4.ms), data4.acc_x];
        dataTable4.addRow(row4);
        chart4.draw(dataTable4, options);
      });
        
      const dataTable5 = google.visualization.arrayToDataTable([
        ['Time', ' Y-Force (kN)'],
        [new Date('hh-mm-ss'),0],
      ]);
        
      const chart5 = new google.visualization.ScatterChart(
        document.getElementById('Live_acc_Chart_y'));
        
      const channel5 = pusher4.subscribe('live_acc');
      channel5.bind('current_acc', data4 => {
        const row5 = [new Date(data4.ye,data4.mo,data4.da,data4.ho,data4.mi,data4.se,data4.ms), data4.acc_y];
        dataTable5.addRow(row5);
        chart5.draw(dataTable5, options);
      });
        
      const dataTable6 = google.visualization.arrayToDataTable([
        ['Time', ' Z-Force (kN)'],
        [new Date('hh-mm-ss'),0],
      ]);
        
      const chart6 = new google.visualization.ScatterChart(
        document.getElementById('Live_acc_Chart_z'));
    
      const channel6 = pusher4.subscribe('live_acc');
      channel6.bind('current_acc', data4 => {
        const row6 = [new Date(data4.ye,data4.mo,data4.da,data4.ho,data4.mi,data4.se,data4.ms), data4.acc_z];
        dataTable6.addRow(row6);
        chart6.draw(dataTable6, options);
      });
        
    });
  </script>
  updated: 2022-10-21-16-00 -7:00
</body>
</html>
